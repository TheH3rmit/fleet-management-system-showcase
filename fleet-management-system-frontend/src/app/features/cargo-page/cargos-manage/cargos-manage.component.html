<div class="page">
  <div class="page-header">
    <h1>Cargos</h1>

    <div class="actions">
      <button mat-raised-button color="primary" type="button" (click)="openCreate()">
        <mat-icon>add</mat-icon>
        Add cargo
      </button>
    </div>
  </div>

  <div class="filters">
    <mat-form-field appearance="outline">
      <mat-label>Search</mat-label>
      <input matInput [formControl]="searchCtrl" placeholder="Id, transport, description, weight, volume..." />
    </mat-form-field>
  </div>

  <div class="table-wrapper mat-elevation-z2">
    <table
      mat-table
      [dataSource]="rows()"
      class="full-width"
      matSort
      (matSortChange)="onSort($event)"
    >
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="id">ID</th>
        <td mat-cell *matCellDef="let c">{{ c.id }}</td>
      </ng-container>

      <ng-container matColumnDef="transportId">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="transportId">Transport</th>
        <td mat-cell *matCellDef="let c">{{ c.transportId ?? 'N/A' }}</td>
      </ng-container>

      <ng-container matColumnDef="cargoDescription">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="cargoDescription">Description</th>
        <td mat-cell *matCellDef="let c" class="wrap">{{ c.cargoDescription }}</td>
      </ng-container>

      <ng-container matColumnDef="weightKg">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="weightKg">Weight (kg)</th>
        <td mat-cell *matCellDef="let c">{{ c.weightKg ?? 'N/A' }}</td>
      </ng-container>

      <ng-container matColumnDef="volumeM3">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="volumeM3">Volume (m3)</th>
        <td mat-cell *matCellDef="let c">{{ c.volumeM3 ?? 'N/A' }}</td>
      </ng-container>

      <ng-container matColumnDef="pickupDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="pickupDate">Pickup</th>
        <td mat-cell *matCellDef="let c">
          {{ c.pickupDate ? (c.pickupDate | date:'short') : 'N/A' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="deliveryDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="deliveryDate">Delivery</th>
        <td mat-cell *matCellDef="let c">
          {{ c.deliveryDate ? (c.deliveryDate | date:'short') : 'N/A' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let c" class="actions-col">
          <button mat-icon-button type="button" (click)="openEdit(c)" matTooltip="Edit" aria-label="Edit">
            <mat-icon>edit</mat-icon>
          </button>
          <span [matTooltip]="deleteTooltip(c)" [matTooltipDisabled]="canDelete(c)">
            <button
              mat-icon-button
              color="warn"
              type="button"
              (click)="delete(c)"
              matTooltip="Delete"
              [disabled]="!canDelete(c)"
              aria-label="Delete"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="cols"></tr>
      <tr mat-row *matRowDef="let row; columns: cols;"></tr>
    </table>
  </div>

  <div class="loading" *ngIf="loading()">
    <mat-progress-spinner diameter="28" mode="indeterminate"></mat-progress-spinner>
  </div>

  <mat-paginator
    [length]="total()"
    [pageIndex]="pageIndex()"
    [pageSize]="pageSize()"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="onPage($event)"
  ></mat-paginator>

  <div *ngIf="!loading() && total() === 0" style="margin-top: 1rem">
    No cargos to show.
  </div>
</div>
