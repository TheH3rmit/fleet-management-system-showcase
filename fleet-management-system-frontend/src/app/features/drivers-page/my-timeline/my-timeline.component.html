<div class="section">
  <div class="section-header">
    <h3>My timeline</h3>
    <div class="controls">
      <button
        mat-stroked-button
        type="button"
        [color]="viewMode() === 'current' ? 'primary' : undefined"
        (click)="setMode('current')"
      >
        Current
      </button>
      <button
        mat-stroked-button
        type="button"
        [color]="viewMode() === 'history' ? 'primary' : undefined"
        (click)="setMode('history')"
      >
        History
      </button>
      <mat-form-field appearance="outline" class="transport-select">
        <mat-label>Select transport</mat-label>
        <mat-select
          [value]="selectedTransportId()"
          (selectionChange)="onTransportChange($event.value)"
          [disabled]="transportOptions().length === 0"
        >
          <mat-option *ngFor="let t of transportOptions()" [value]="t.id">
            #{{ t.id }} - {{ t.status }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-stroked-button type="button" (click)="load()" [disabled]="loading()">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
    </div>
  </div>

  <div class="state" *ngIf="loading()">
    <mat-progress-spinner diameter="28" mode="indeterminate"></mat-progress-spinner>
    <span>Loading...</span>
  </div>

  <div class="error" *ngIf="!loading() && error()">{{ error() }}</div>

  <div class="table-wrapper mat-elevation-z2" *ngIf="!loading() && !error()">
    <table mat-table [dataSource]="filteredTimeline()">
      <ng-container matColumnDef="changedAt">
        <th mat-header-cell *matHeaderCellDef>When</th>
        <td mat-cell *matCellDef="let x">
          {{ changedAt(x) ? (changedAt(x) | date:'short') : 'N/A' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="entity">
        <th mat-header-cell *matHeaderCellDef>Entity</th>
        <td mat-cell *matCellDef="let x">{{ entity(x) }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let x">{{ status(x) }}</td>
      </ng-container>

      <ng-container matColumnDef="note">
        <th mat-header-cell *matHeaderCellDef>Note</th>
        <td mat-cell *matCellDef="let x">{{ note(x) }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="cols"></tr>
      <tr mat-row *matRowDef="let row; columns: cols"></tr>
    </table>

    <div class="empty" *ngIf="(filteredTimeline()?.length ?? 0) === 0">
      No timeline entries.
    </div>
  </div>
</div>
